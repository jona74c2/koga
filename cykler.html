<!DOCTYPE html>
<html lang="DA">

<head>
    <link href="https://fonts.googleapis.com/css?family=PT+Sans+Narrow&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=PT+Sans&display=swap" rel="stylesheet">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>

    <nav class="main_menu">

    </nav>


    <video id="bg_video" autoplay muted loop>
        <source src="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/KOGA_Preview_Elcykel_1080pYoutube.mp4" type="video/mp4">
    </video>

    <nav class="menu">

        <div class="menu_mob">
            <button data-kategori="alle" data-video="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/KOGA_Preview_Elcykel_1080pYoutube.mp4" class="valgt">Alle</button>
            <button data-kategori="Bycykel" data-video="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/KOGA_Preview_Trekking_1080pYoutube.mp4">Bycykler</button>

            <button data-kategori="Elcykel" data-video="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/KOGA_Preview_Elcykel_1080pYoutube.mp4">Elcykler</button>

            <button data-kategori="Racercykel" data-video="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/KOGA_Preview_Racer_1080pYoutube.mp4">Racercykler</button>

            <button data-kategori="Trekking" data-video="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/KOGA_Preview_Trekking_1080pYoutube.mp4">Trekking</button>
        </div>
    </nav>
    <hr>
    <h1></h1>

    <template>
        <article class="cykel">
            <div class="cykel_bgcolor">
                <h3 class="backText"></h3>
                <p class="cykler_p"></p>
                <a class="model_women"></a>
                <a class="model_men"></a>
                <img class="cykler_backimage" src="" alt="">
                <img class="cykler_image" src="" alt="">
                <h2 class="cykler_h2"></h2>

            </div>
        </article>
    </template>
    <h1></h1>
    <main>
        <section id="liste"></section>
    </main>

    <script>
        let cycles = [];
        const filterButtons = document.querySelectorAll("button");
        let filterString = "alle";
        document.addEventListener("DOMContentLoaded", start);

        const urlParams = new URLSearchParams(window.location.search);
        console.log("urlparams " + urlParams);
        const id = urlParams.get("model");
        console.log("id " + id);

        function start() {
            getJson();
            getMenu();
            //Her laves et tjek om der er noget med i urlen. Hvis der er, så kaldes filter på den modeltype fra start
            if (id != null) {
                filterButtons.forEach(knap => {
                    if (knap.dataset.kategori == id) {
                        filter(knap);
                    }
                })
                /*filterString = id;
                console.log("We here! " + filterString);
                filter();*/
            }
        }

        async function getJson() {
            const url = "http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-json/wp/v2/Cykel";
            let myJson = await fetch(url);

            cycles = await myJson.json();
            showContent();
            //console.log(cycles);
        }

        async function getMenu() {
            const thisNav = await fetch("mainnavigation.html");
            let fetchedNav = await thisNav.text();
            document.querySelector(".main_menu").innerHTML = fetchedNav;
        }

        filterButtons.forEach(knap => knap.addEventListener("click", function() {
            filter(this);
        }));


        function filter(button) {
            //filtersættes til teksten fra den knap der blev trykket på
            filterString = button.dataset.kategori;
            document.querySelector("#bg_video").src = button.dataset.video;
            //overskriften ændres til at sige hvordan der filtreres
            //document.querySelector(".overskrift_kategori").textContent = `${this.textContent} Cocktails`;
            //den highlightede knap flyttes til den nye aktive kategori
            filterButtons.forEach(knap => knap.classList.remove("valgt"));
            button.classList.add("valgt");
            showContent();
        }

        function showContent() {
            liste.innerHTML = "";
            cycles.forEach(bike => {
                console.log(bike.kategorier[0]);
                if (bike.kategorier[0] == filterString || filterString == "alle") {

                    const clone = document.querySelector("template").cloneNode(true).content;

                    clone.querySelector(".backText").textContent = bike.pris;
                    clone.querySelector(".model_women").textContent = "Damecykel";
                    clone.querySelector(".model_men").textContent = "Herrecykel"
                    "Damecykel";

                    clone.querySelector(".cykler_backimage").src = bike.oplevelsesbillede.guid;

                    //This is a try to go through different imagessizes to find the correct one. It needs to make a call for each try to check if the current imageadress is legit

                    /*
                    let k = 0;
                    while (clone.querySelector(".cykler_image").src != "" && k <= 40) {
                        try {
                            console.log("Dette er forsøg nr: " + k);
                            console.log("Dette er src: " + clone.querySelector(".cykler_image").src);
                            clone.querySelector(".cykler_image").src = bike.billede_hele_cyklen_1.guid.substring(0, bike.billede_hele_cyklen_1.guid.length - 4) + "-300x" + (180 + k) + bike.billede_hele_cyklen_1.guid.substring(bike.billede_hele_cyklen_1.guid.length - 4, bike.billede_hele_cyklen_1.guid.length + 1);
                        } catch (e) {
                            console.log(e);
                        }
                        k++;
                    }*/



                    //This code works for images 300x200 no matter what format. This covers 5 out of 8 of the images, which isn't good enough

                    /*clone.querySelector(".cykler_image").src = bike.billede_hele_cyklen_1.guid.substring(0, bike.billede_hele_cyklen_1.guid.length - 4) + "-300x200" + bike.billede_hele_cyklen_1.guid.substring(bike.billede_hele_cyklen_1.guid.length - 4, bike.billede_hele_cyklen_1.guid.length + 1);*/

                    // This code set all images on the cykler page to the correct image but each image is about 10mp, which decreases loading speed a lot! Like a lot a lot
                    clone.querySelector(".cykler_image").src = bike.billede_hele_cyklen_1.guid;

                    clone.querySelector("h2").textContent = bike.title.rendered;
                    clone.querySelector("p").innerHTML = bike.kort_beskrivelse;
                    document.querySelector("section").appendChild(clone);

                    document.querySelector("section").lastElementChild.addEventListener("click", () => {
                        location.href = `detail.html?id=${bike.id}`;
                    });
                }
            })
        }
    </script>
</body></html>
