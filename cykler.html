<!DOCTYPE html>
<html lang="DA">

<head>
    <link href="https://fonts.googleapis.com/css?family=Duru+Sans|PT+Sans+Narrow|PT+Sans:700&display=swap" rel="stylesheet">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koga Cykler | En cykel for livet</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>

    <nav class="main_menu">

    </nav>


    <video id="bg_video" autoplay muted loop>
        <source src="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/koga_preview_race.mp4" type="video/mp4">
    </video>

    <h2 id="category_headline" class="margin_10"></h2>
    <p id="category_text" class="margin_10"></p>

    <nav class="menu">

        <div class="menu_mob">
            <button data-kategori="alle" data-video="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/koga_preview_race.mp4" data-headline="
            TOP PERFORMANCE" data-text="For those that compete for gold medals, or simply just heading home from the supermarket with a big smile and two full shopping bags. Whatever level of performance you want, we make the bike that fits it perfectly. We bet you will soon be whistling as you sit on your Koga?" class="valgt">Alle</button>

            <button data-kategori="Bycykel" data-video="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/koga_preview_trekking.mp4" data-headline="LIGHT & SPORTIVE" data-text="Light, sporty and luxuriously finished with finesse. There is a reason why Koga is recognised as the expert in recreational touring bikes. A KOGA Touring bicycle guarantees optimal riding pleasure. Their fabulous characteristics and solid quality make every bicycle ride a special experience.">Bycykler</button>

            <button data-kategori="Elcykel" data-video="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/koga_preview_elcykel.mp4" data-headline="ACTIVE RELAXATION" data-text="An E-Bike is an electric bike with pedal assistance. The assistance is only activated when the bikes pedals rotate. E-Bikes are available for all ages and for a variety of purposes, from touring to the daily commute to work. With an E-Bike you can move effortlessly and in style.">Elcykler</button>

            <button data-kategori="Racercykel" data-video="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/koga_preview_race.mp4" data-headline="THE WILL TO WIN" data-text="Developing top quality racing bicycles is embedded in Koga's DNA. Passion for cycling was the foundation in establishing the company in 1974, and is the unmistakable basis of its modern and advanced race collection to this day. Developed and built in the Netherlands, by and for cycling enthusiasts with attention to detail.">Racercykler</button>

            <button data-kategori="Trekking" data-video="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/koga_preview_trekking.mp4" data-headline="PURE ADVENTURE" data-text="Adventurous riders choose KOGA for a reason. KOGA Trekking bicycles represent proven reliability and perfect workmanship. A bicycle for the true aficionado who will only accept the very best. The distinguishing quality of the long distance models continue in their design, which have been rewarded with a number of design awards.">Trekking</button>
        </div>
    </nav>
    <hr>
    <div class="ia_links margin_10">
        <a href="kogacenter.html">Kogacenter</a>
        &#x25B8;
        <a href="cykler.html">Cykler</a>
    </div>
    <template>
        <article class="cykel">



            <div class="cykel_bgcolor">
                <div class="cykel_bgimage">
                    <img class="hidden_image" src="" alt="" style="visibility: hidden;" />

                    <!--<img class="cykler_image" src="" alt="">-->
                    <div class="backtext_container">
                        <div class="backtext_background"></div>
                        <h3 class="price"></h3>
                        <p class="cykler_p"></p>
                    </div>
                    <h2 class="cykler_h2"></h2>

                </div>
            </div>
        </article>
    </template>
    <h1></h1>
    <main id="bikes_overview">
        <section id="liste"></section>

    </main>
    <footer></footer>

    <script>
        let cycles = [];
        const filterButtons = document.querySelectorAll("button");
        let filterString = "alle";
        document.addEventListener("DOMContentLoaded", start);

        const urlParams = new URLSearchParams(window.location.search);
        console.log("urlparams " + urlParams);
        const id = urlParams.get("model");
        console.log("id " + id);

        function start() {
            getJson();
            getMenu();
            getFooter();

            if (filterString == "alle") {

                filter(document.querySelector("button"));
            } else {
                filterButtons.forEach(knap => {
                    if (knap.dataset.kategori == id) {
                        filter(knap);
                    }

                })

            }

            /*filterString = id;
            console.log("We here! " + filterString);
            filter();*/
        }

        async function getJson() {
            const url = "http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-json/wp/v2/Cykel";
            let myJson = await fetch(url);

            cycles = await myJson.json();
            showContent();
            //console.log(cycles);
        }

        async function getMenu() {
            const thisNav = await fetch("mainnavigation.html");
            let fetchedNav = await thisNav.text();
            document.querySelector(".main_menu").innerHTML = fetchedNav;

            document.querySelector(".burger_icon").addEventListener("click", function() {
                displayListItems(".burger_item");
            });

            document.querySelector("#list_item_bikes").addEventListener("click", function() {
                displayListItems("#dropdown-content1");
            });
            document.querySelector("#dropbtn2").addEventListener("click", function() {
                displayListItems("#dropdown-content2");
            });
        }

        async function getFooter() {
            const thisFooter = await fetch("footer.html");
            let fetchedFooter = await thisFooter.text();
            document.querySelector("footer").innerHTML = fetchedFooter;
        }

        filterButtons.forEach(knap => knap.addEventListener("click", function() {
            filter(this);
        }));


        function filter(button) {
            //filtersættes til teksten fra den knap der blev trykket på
            filterString = button.dataset.kategori;
            document.querySelector("#bg_video").src = button.dataset.video;
            document.querySelector("#category_headline").textContent = button.dataset.headline;
            document.querySelector("#category_text").textContent = button.dataset.text;
            //overskriften ændres til at sige hvordan der filtreres
            //document.querySelector(".overskrift_kategori").textContent = `${this.textContent} Cocktails`;
            //den highlightede knap flyttes til den nye aktive kategori
            filterButtons.forEach(knap => knap.classList.remove("valgt"));
            button.classList.add("valgt");
            showContent();
        }

        function showContent() {
            liste.innerHTML = "";
            cycles.forEach(bike => {
                console.log(bike.kategorier[0]);
                if (bike.kategorier[0] == filterString || filterString == "alle") {

                    const clone = document.querySelector("template").cloneNode(true).content;

                    clone.querySelector(".price").textContent = bike.pris;

                    //This is a try to go through different imagessizes to find the correct one. It needs to make a call for each try to check if the current imageadress is legit

                    /*
                    let k = 0;
                    while (clone.querySelector(".cykler_image").src != "" && k <= 40) {
                        try {
                            console.log("Dette er forsøg nr: " + k);
                            console.log("Dette er src: " + clone.querySelector(".cykler_image").src);
                            clone.querySelector(".cykler_image").src = bike.billede_hele_cyklen_1.guid.substring(0, bike.billede_hele_cyklen_1.guid.length - 4) + "-300x" + (180 + k) + bike.billede_hele_cyklen_1.guid.substring(bike.billede_hele_cyklen_1.guid.length - 4, bike.billede_hele_cyklen_1.guid.length + 1);
                        } catch (e) {
                            console.log(e);
                        }
                        k++;
                    }*/



                    //This code works for images 300x200 no matter what format. This covers 5 out of 8 of the images, which isn't good enough

                    /*clone.querySelector(".cykler_image").src = bike.billede_hele_cyklen_1.guid.substring(0, bike.billede_hele_cyklen_1.guid.length - 4) + "-300x200" + bike.billede_hele_cyklen_1.guid.substring(bike.billede_hele_cyklen_1.guid.length - 4, bike.billede_hele_cyklen_1.guid.length + 1);*/

                    // This code set all images on the cykler page to the correct image but each image is about 10mp, which decreases loading speed a lot! Like a lot a lot
                    clone.querySelector(".cykel_bgimage").style.backgroundImage = `url(${bike.billede_hele_cyklen_1.guid})`;
                    clone.querySelector(".hidden_image").src = bike.billede_hele_cyklen_1.guid;
                    console.log(clone.querySelector(".cykel_bgimage").backgroundImage);
                    clone.querySelector("h2").textContent = bike.title.rendered;
                    clone.querySelector("p").innerHTML = bike.kort_beskrivelse;
                    document.querySelector("section").appendChild(clone);

                    document.querySelector("section").lastElementChild.addEventListener("click", () => {
                        location.href = `detail.html?id=${bike.id}`;
                    });
                }
            })
        }

        function displayItem(s) {
            let x = document.querySelectorAll(`${s}`);
            if (x.style.display === "block") {
                x.style.display = "none";
            } else {
                x.style.display = "block";
            }
        }

        function displayListItems(s) {
            document.querySelectorAll(`${s}`).forEach((x, i) => {
                if (x.style.display === "block") {
                    x.style.display = "none";
                } else {
                    x.style.display = "block";
                }
            })

        }

    </script>
</body>

</html>
