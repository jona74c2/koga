<!DOCTYPE html>
<html lang="DA">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>

    <nav class="main_menu">

    </nav>


    <video id="bg_video" autoplay muted loop>
        <source src="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/koga_elcykel.mp4" type="video/mp4">
    </video>

    <nav class="menu">
        <button data-kategori="alle" data-video="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/koga_elcykel.mp4" class="valgt">Alle</button>

        <button data-kategori="Bycykel" data-video="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/koga_trekking.mp4">Bycykler</button>

        <button data-kategori="Elcykel" data-video="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/koga_elcykel.mp4">Elcykler</button>

        <button data-kategori="Racercykel" data-video="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/koga_racer.mp4">Racercykler</button>

        <button data-kategori="Trekking" data-video="http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-content/uploads/2019/11/koga_trekking.mp4">Trekking</button>
    </nav>

    <h1></h1>

    <template>
        <article class="cykel">
            <div class="cykel_bgcolor">
                <h3 class="backText"></h3>
                <p class="cykler_p"></p>
                <a class="model_women"></a>
                <a class="model_men"></a>
                <img class="cykler_backimage" src="" alt="">
                <img class="cykler_image" src="" alt="">
                <h2 class="cykler_h2"></h2>

            </div>
        </article>
    </template>
    <h1></h1>
    <main>
        <section id="liste"></section>
    </main>

    <script>
        let retter = [];
        const filterKnapper = document.querySelectorAll("button");
        let filter = "alle";
        document.addEventListener("DOMContentLoaded", start);

        function start() {
            hentJson();
            getMenu();
        }

        async function hentJson() {
            const url = "http://beansprout.dk/kea/2.semester/tema9/Koga/wordpress/wp-json/wp/v2/Cykel";
            let myJson = await fetch(url);

            retter = await myJson.json();
            visIndhold();
            console.log(retter);
        }

        async function getMenu() {
            const thisNav = await fetch("mainnavigation.html");
            let fetchedNav = await thisNav.text();
            document.querySelector(".main_menu").innerHTML = fetchedNav;
        }

        filterKnapper.forEach(knap => knap.addEventListener("click", filtrer));

        function filtrer() {

            //filter sættes til teksten fra den knap der blev trykket på
            filter = this.dataset.kategori;
            document.querySelector("#bg_video").src = this.dataset.video;
            //overskriften ændres til at sige hvordan der filtreres
            //document.querySelector(".overskrift_kategori").textContent = `${this.textContent} Cocktails`;
            //den highlightede knap flyttes til den nye aktive kategori
            filterKnapper.forEach(knap => knap.classList.remove("valgt"));
            this.classList.add("valgt");
            visIndhold();
        }

        function visIndhold() {
            liste.innerHTML = "";
            retter.forEach(ret => {
                console.log(ret.kategorier[0]);
                if (ret.kategorier[0] == filter || filter == "alle") {

                    const klon = document.querySelector("template").cloneNode(true).content;

                    klon.querySelector(".backText").textContent = ret.pris;
                    klon.querySelector(".model_women").textContent = "Damecykel";
                    klon.querySelector(".model_men").textContent = "Herrecykel"
                    "Damecykel";

                    klon.querySelector(".cykler_backimage").src = ret.oplevelsesbillede.guid;
                    /*
                    let k = 0;
                    while (klon.querySelector(".cykler_image").src != "" && k <= 40) {
                        try {
                            console.log("Dette er forsøg nr: " + k);
                            console.log("Dette er src: " + klon.querySelector(".cykler_image").src);
                            klon.querySelector(".cykler_image").src = ret.billede_hele_cyklen_1.guid.substring(0, ret.billede_hele_cyklen_1.guid.length - 4) + "-300x" + (180 + k) + ret.billede_hele_cyklen_1.guid.substring(ret.billede_hele_cyklen_1.guid.length - 4, ret.billede_hele_cyklen_1.guid.length + 1);
                        } catch (e) {
                            console.log(e);
                        }
                        k++;
                    }*/





                    klon.querySelector(".cykler_image").src = ret.billede_hele_cyklen_1.guid.substring(0, ret.billede_hele_cyklen_1.guid.length - 4) + "-300x200" + ret.billede_hele_cyklen_1.guid.substring(ret.billede_hele_cyklen_1.guid.length - 4, ret.billede_hele_cyklen_1.guid.length + 1);

                    klon.querySelector("h2").textContent = ret.title.rendered;
                    klon.querySelector("p").innerHTML = ret.kort_beskrivelse;
                    document.querySelector("section").appendChild(klon);

                    document.querySelector("section").lastElementChild.addEventListener("click", () => {
                        location.href = `detail.html?id=${ret.id}`;
                    });
                }
            })
        }

        /*function bikeHover(bike) {
            console.log(bike);
            bike.querySelector("img").src = ret.billede_hele_cyklen_3.guid;
        }*/
    </script>
</body></html>
